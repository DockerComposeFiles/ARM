# Verbindet den Websocket miteinander
version: '3.8'
services:
  backend:
    container_name: py_backend
    build: ./py_backend
    deploy:
      placement:
        constraints:
          - node.labels.project == visualizer
    volumes:
      - type: volume
        source: data  # volume Name
        target: /data
        volume:
          nocopy: true
    ports:
      - "3000:3000"
    networks:
      macvlan:
        ipv4_address: 172.24.0.5
    links:
      - "visualiser:vis"

  visualiser:
    container_name: bmp_280_web_visualizer
    build: ./visualizer
    deploy:
      placement:
        constraints:
          - node.labels.project == visualizer
    volumes:
      - /htdocs/ /usr/local/apache2/htdocs/
    ports:
      - "80:80"
      - "433:433"
      - "3000:3000"
    networks:
      macvlan:
#        ipv4_address: 172.24.0.2
#    expose:


volumes:
  data:

networks:
  macvlan:
    driver: macvlan0
    driver_opts:
      parent: eth0
    ipam:
      driver: default
      config:
        - subnet: 172.24.0.0/24
          gateway: 172.24.0.1
